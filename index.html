<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DJ DrumKit</title>
  <meta name="theme-color" content="#0a0a0a" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    :root{
      --bg:#0b0c10;--card:#161824;--muted:#9aa0a6;--text:#e7e7ea;--br:16px;
      --stroke:#23283b; --accent:#5ea4d4; --accent2:#c36bff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans","Helvetica Neue",sans-serif;
      background:radial-gradient(1200px 800px at 80% -10%,#1a1f2e 0%,#0b0c10 40%),var(--bg);
      color:var(--text);
    }
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;position:sticky;top:0;z-index:3;backdrop-filter:blur(6px)}
    header h1{font-size:18px;margin:0;letter-spacing:.4px}
    main{max-width:1100px;margin:18px auto;padding:0 12px 24px}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 12;background:var(--card);border:1px solid var(--stroke);border-radius:var(--br);padding:14px;box-shadow:0 10px 40px rgba(0,0,0,.30)}
    @media(min-width:860px){.span-6{grid-column:span 6}.span-4{grid-column:span 4}.span-8{grid-column:span 8}}
    h2{margin:6px 0 10px;font-size:16px}
    input,button,select{border-radius:12px;border:1px solid var(--stroke);background:#0f1220;color:var(--text);padding:10px 12px}
    button{cursor:pointer}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .muted{color:var(--muted);font-size:12px}
    .pill{font-size:11px;padding:4px 8px;border-radius:999px;background:#121831;border:1px solid #263057;color:#a8b4ff}
    /* Drum “pad” area */
    #padArea{position:relative;min-height:360px;border:1px dashed var(--stroke);border-radius:12px;background:#0e1020}
    .pad{
      position:absolute; min-width:84px; min-height:56px; padding:8px 10px;
      border-radius:12px; border:1px solid #2b3150; background:linear-gradient(180deg,#181d33,#12172a);
      display:flex; flex-direction:column; gap:6px; user-select:none; cursor:grab;
    }
    .pad:active{cursor:grabbing}
    .pad .title{font-weight:600}
    .pad button{padding:6px 8px; font-size:12px}
    /* Video preview */
    #localVid{transform:scaleX(-1)} /* selfie preview */
    video, canvas { background:#000; }
  </style>
</head>
<body>
  <header>
    <h1>DJ DrumKit • PWA</h1>
    <div class="row">
      <span id="authState" class="muted">Signed out</span>
      <button id="signInBtn">Sign in</button>
      <button id="signOutBtn" style="display:none">Sign out</button>
    </div>
  </header>

  <main class="grid">
    <!-- Left: Pads / Controls -->
    <section class="card span-8">
      <h2>Playground</h2>
      <div class="row" style="margin-bottom:8px">
        <button id="addPad">Add Pad</button>
        <button id="saveScene">Save Scene</button>
        <button id="clearScene">Clear Scene</button>
        <span class="muted">Drag pads. Click to assign sound. “Loop” to repeat.</span>
      </div>
      <div id="padArea"></div>
    </section>

    <!-- Right: Call + Record -->
    <section class="card span-4">
      <h2>Call & Record</h2>

      <div class="row" style="margin-bottom:8px">
        <input id="roomInput" placeholder="Room code (e.g., dj-123)" style="flex:1;min-width:160px">
        <button id="callBtn">Call</button>
        <button id="hangupBtn" disabled>Hang up</button>
      </div>

      <div class="row" style="gap:10px;margin-bottom:8px">
        <video id="localVid" autoplay muted playsinline style="width:160px;border-radius:12px"></video>
        <video id="remoteVid" autoplay playsinline style="width:160px;border-radius:12px"></video>
      </div>

      <canvas id="mixCanvas" width="640" height="360" style="width:100%;border:1px solid var(--stroke);border-radius:12px"></canvas>

      <div class="row" style="margin-top:8px">
        <button id="startAV">Start Video Rec</button>
        <button id="stopAV" disabled>Stop Video Rec</button>
        <button id="shareAV" disabled>Share</button>
      </div>

      <div class="muted" style="margin-top:8px">
        Tip: Each person sees their own camera large; the other appears as PiP.
      </div>
    </section>

    <!-- Audio tags (hidden/local muted) -->
    <audio id="localAudio" autoplay muted playsinline></audio>
    <audio id="remoteAudio" autoplay playsinline></audio>
  </main>

  <!-- PWA SW (very light cache safety) -->
  <script>
  (function(){
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/service-worker.js').catch(()=>{});
    }
  })();
  </script>

  <!-- App entry (Vite) -->
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
